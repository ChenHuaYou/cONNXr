# 03 Contributing
This project is in very early state so we are looking for contributors. Feel free to open a PR or an issue with questions or suggestions. We would be also happy to guide you if you have an idea. You can contribute in many ways, but the most common is to implement a new operator. The `onnx` specification defines more than 150 operators, that are supported for different types (float, int, double,...) and for some of them there are different versions. Some common ones are implemented with limited functionality like convolutions, matrix multiplications and so on, but there are lots of them remaining.

You can also contribute by improving an existing operator or fixing some bugs. Feel free to have a look to the opened issues, where we also have some simple issues for newcomers.

## Add new operator

If you want to add a new operator, we provide a simple and generic interface that you can use, with all the information in place ready to be used. The interface is the following.
```c
struct node_context{
  Onnx__NodeProto     *onnx_node;
  Onnx__TensorProto  **inputs;
  Onnx__TensorProto  **outputs;
  operator_executer resolved_op;
};
```

Lets say that you want to implement the `Add` operator, that just adds two numbers or tensors. You can access to its inputs with the following code. Once you have that, its pretty straightforward to access the data within the tensor (see `Onnx__TensorProto` struct)

```c
Onnx__TensorProto *A = searchInputByName(ctx, 0);
Onnx__TensorProto *B = searchInputByName(ctx, 1);
```

On the other hand you will need to store the result in a variable, so that other nodes can reuse that output. Just use the following function and populate the content.

```c
Onnx__TensorProto *C = searchOutputByName(ctx, 0);
```

If the operator you are implementing has some attributes, you can also easily get them with. Just replace `auto_pad` by your attribute name.

```c
Onnx__AttributeProto *auto_pad = searchAttributeNyName(
  ctx->onnx_node->n_attribute,
  ctx->onnx_node->attribute,
  "auto_pad");
```

If you want to implement an operator, we would suggest to follow the following steps:
* 1. First of all decide the operator that you want to implement. You can see the [official onnx operators list](https://github.com/onnx/onnx/blob/master/docs/Operators.md). Lets say that you want to implement the `Conv` operator, fair enough.
* 2. Second step is to decide which version you want to implement. We would recommend you to implement the latest one. The differences can be rather tiny, but its not the same [Abs-13](https://github.com/onnx/onnx/blob/master/docs/Changelog.md#Abs-13) operator than [Abs-6](https://github.com/onnx/onnx/blob/master/docs/Changelog.md#Abs-6). Note that the number is the onnx version that introduced that operator.
* 3. Once you know the operator and version, there is one extra "dimension" to take into account. Most of the operators work with different data types, so you must choose which one to implement. Going back to the `Conv` example, we would suggest to start implementing the `float` version. Note that `Conv` is defined for double, float and float16. The code would be of course quite similar, but since we are in C we can't just use the same functions for all types.
* 4. So lets say that you want to implement `Conv` operator for version `11` and `float` variation. Now you should go to `include/operators/onnx/` and verify that `operator__onnx__conv__11.h` exists. If it doesn't it can be generated with the Python script in `scripts/onnx_generator`. Long story short, this is an autogenerated file that contains the function declarations of the operator. If that file doesn't exist for your operator, and you can't figure out how to generate it, feel free to contact us.
* 5. Now that we are sure that everything is in place, you are ready to implement the operator. Using the `Conv` example, you must create a function that matches the name defined in `operator__onnx__conv__11.h`. This file may exist though. See `src/implementation/`
* 6. Inside the function that you've just created, implement the operator according to the onnx specification. You can use other existing operators as reference. Inside `node_context` structure that is used as the input for every operator, you will find all the data that you need for the operator, like its inputs or attributes.
* 7. Once the operator is implemented, you are ready to test it. Luckily, onnx provides a set of [test vectors](https://github.com/onnx/onnx/tree/master/onnx/backend/test/data/node) for all operators, and we have taken care of integrating them, so you just need to go to `tests.c` file and uncomment the test case of your operator. For example, if you have implemented the `Shrink` operator, you should uncomment `test_shrink_hard` and `test_shrink_hard`. Its important to note that this test cases are not testing all data types (float, double,...). Most of these test cases run on float, but not always.


TODO: A picture is worth more than a thousand words, so an example pull request would be for sure better than raw text.

## Other contributions
You can also contribute in other ways, like improving an existing operator, fixing bugs or writing documentation.
